# 🧭 開発ルール

## ディレクトリと命名
- Go モジュールは `src/` に配置。`go run` や `go test` を行う際は `src` へ移動して実行します。
- ドメインごとに `internal/controller`, `internal/service`, `internal/repository`, `internal/model`, `internal/util` に分割します。
- テストコードは `src/test/<layer>` に配置し、実パッケージと同じ名前空間を利用します。

## 依存方針
- Controller → Service → Repository の一方向依存を維持します。
- Repository はファイルシステムへのアクセスのみを担当し、ビジネスロジックを持たせません。
- 日付変換などの共通処理は `internal/util` に集約します。

## CSV 運用
- 生 CSV は `src/csv/netflix/` に配置します。複数ある場合は最新 1 ファイルのみを処理対象とします。
- 履歴 CSV (`src/csv/history.csv`) は Git 管理外のファイルとして運用します。.gitignore に含まれていることを確認してください。
- CSV のスキーマ変更が必要な場合は [`docs/design/README.md`](../design/README.md) を更新したうえで実装します。

## テストと品質
- `go test ./...` を最小単位で実行し、サービスロジックとリポジトリのテストを維持します。
- 追加のユーティリティを実装する際はテスト容易性を考慮し、純粋関数を心がけます。
- 例外的なフォーマット（不正な日付など）が想定される場合はテストケースを追加して回帰を防ぎます。

## コーディングスタイル
- `go fmt` / `go vet` / `golangci-lint` の利用を推奨します。
- 外部依存を追加する場合は `go.mod` を更新し、ドキュメントに理由を記載します。
- 公開予定の API は無く、すべて内部パッケージとして扱います。

## PR / レビュー
- ドキュメントを変更した場合は、関連する仕様書へのリンクも合わせて更新します。
- 入出力仕様に影響する変更は必ず `docs/` 配下の該当箇所を修正し、README からのリンクを最新に保ちます。
